#! /bin/sh

# Monitor Config
internal_monitor="DP-4"
external_monitor="HDMI-0"
external_monitor_connected=$(xrandr --query | grep $external_monitor)

if [[ $external_monitor_connected = *" connected"* ]]; then
    xrandr --output $internal_monitor --primary --output $external_monitor --right-of $internal_monitor
    bspc monitor $internal_monitor -d 1 2 3 4 5
    bspc monitor $external_monitor -d 6 7 8 9 10
    bspc wm -O $internal_monitor $external_monitor
else
    bspc monitor $external_monitor --remove
    bspc monitor $internal_monitor -d 1 2 3 4 5 6 7 8 9 10
fi

# Fix Mouse cursor on startup 
xsetroot -cursor_name left_ptr

# Setup X
xset r rate 200 30
xset s 120 120
# localectl set-keymap us ru

# BSPWM Config
bspc config border_width            1
bspc config top_padding             42
bspc config right_padding           0
bspc config left_padding            0
bspc config bottom_padding          0
bspc config window_gap              0
bspc config top_monocle_padding     0
bspc config right_monocle_padding   0
bspc config left_monocle_padding    0
bspc config bottom_monocle_padding  0

bspc config focused_border_color    "#177868"
bspc config normal_border_color     "#3B4252"
bspc config active_border_color     "#00FF00"
bspc config presel_feedback_color   "#D8DEE9"
bspc config split_ratio             0.50
bspc config borderless_monocle      true  
bspc config gapless_monocle         false
bspc config focus_follows_pointer   true
bspc config external_rules_command  "$HOME/.config/bspwm/external_rules.sh"
bspc config merge_overlapping_monitors true

# Application Rules
# Use command "xprop | grep WM_CLASS" to find the name of the application to be entered below
# After the command click on the application window and the name will be generated after the command and use the name generated by this command.
# Search "Bare-bones window manger by Angad Sharma" on dev.to for more
bspc rule -a Brave-browser      desktop='^1'    follow=on
bspc rule -a Gimp               desktop='^8'    follow=on
bspc rule -a wine               desktop='^7'    follow=on state=floating
bspc rule -a variety                            state=floating
bspc rule -a Chromium           desktop='^2'
bspc rule -a mplayer2                           state=floating
bspc rule -a Kupfer.py                          focus=on
bspc rule -a Screenkey                          manage=off
bspc rule -a discord            desktop='^4'
bspc rule -a firefox            desktop='^3'
bspc rule -a TelegramDesktop    desktop='^4'
bspc rule -a synergy            desktop='^9'

nitrogen --restore

# Auto-Start
bash ~/.config/polybar/launch.sh &

while :; do
    if pgrep -x sxhkd > /dev/null; then
        true
    else
        sxhkd &
    fi
    sleep 5
done &

picom --config "$HOME/.config/bspwm/picom.conf" 

